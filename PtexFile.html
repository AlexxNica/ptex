<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link href="ptex.css" rel="stylesheet" type="text/css">
</head>
<body><h1>Ptex File Format Specification Version 1.3r1<br>
</h1>
Revision history:<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">1.0<br>
      </td>
      <td style="vertical-align: top;">9/29/06<br>
      </td>
      <td style="vertical-align: top;">Initial Release<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">1.1<br>
      </td>
      <td style="vertical-align: top;">2/27/07<br>
      </td>
      <td style="vertical-align: top;">"Edit face data" amended to
included precomputed constant value<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">1.2<br>
      </td>
      <td style="vertical-align: top;">1/5/09<br>
      </td>
      <td style="vertical-align: top;">Added: subface flag, const
neighborhood flag, u/v border modes, separately stored large metadata
items.<br> Clarified triangle texture storage.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">1.3<br>
      </td>
      <td style="vertical-align: top;">10/20/09<br>
      </td>
      <td style="vertical-align: top;">Corrected size of "keysize" and "datatype" in meta data spec to match implementation.<br>
Revised large metadata spec (not previously implemented).<br> Added "editdatapos" to extended header. <br> Added "compatibility barrier" for pre-1.3 file readers.<br>
Added minor version to header.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">1.3r1<br>
      </td>
      <td style="vertical-align: top;">6/2/10<br>
      </td>
      <td style="vertical-align: top;">Corrected details of Constant Data block to match implementation.<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<h3>General Notes:</h3>
<ul>
  <li>A "face" is one face of a polymesh.&nbsp; The polymesh has a base
type of either quad or triangle.&nbsp; For quad meshes, ptex stores
rectangular textures.&nbsp; For triangle meshes, ptex stores triangular
textures.<br>
  </li>
  <li>Non-quads
embedded in a quad mesh and non-tris embedded in a tri-mesh are
subdivided once to generate quad/tri subfaces and textures are stored
per subface.<br>
  </li>
  <li>Every face (or subface) has a unique index, or "faceid", which is
implied by
the ordering in the "Face Info" block.&nbsp; The faceids are numbered
starting from zero.&nbsp; Subfaces are ordered in following the edge
order within the parent face.<br>
  </li>
  <li>A "channel" is a scalar data value stored in the file (e.g. one
component of a color).&nbsp; There can
be any number of channels in the file, but all channels must have the
same data type.&nbsp;
Channels are stored separately for better compression.</li>
  <li>A "level" is a set of data across all the faces at a particular
resolution.&nbsp; The first level is the full-res set of data where the
resolution of each face is specified in the "Face Info"
block.&nbsp; Subsequent levels are power-of-two reductions (i.e. "mip
maps").<br>
  </li>
  <li>One channel may optionally be indicated as the alpha
channel.&nbsp; When an
alpha
channel is present, the data values in the first level are expected to
be stored
"unmultiplied" (as opposed to being premultiplied with the
alpha).&nbsp; This choice was made to preserve the original data
in the file for subsequent editing as premultiplying can result in data
loss.&nbsp; The
tradeoff is that the multiplication must now be handled during
filtering.&nbsp;&nbsp; Reduction levels are stored premultiplied.</li>
  <li>Compression, where indicated, uses the "deflate" algorithm as
implemented in
zlib's compress and uncompress functions.&nbsp; Differencing (where
each value is replaced by the difference between the value and the
preceeding value) is used where indicated to achieve
better compression.<br>
  </li>
  <li>All data is stored in "little endian" format.</li>
  <li>Face data is stored in v-major order with the first sample
corresponding to
u=v=0. This is considered the bottom-left corner with u pointing right
and v pointing up.</li>
  <li>Triangle texture data is stored in a specialized layout
  (documented elsewhere).  The texels are packed into a square texture
  for storage.  The number of texels is the same as for quad textures
  (n-squared texels where n is a power-of-two) though only isotropic
  textures are supported (i.e. ures = vres).  Storage of the
  square-packed triangle textures is identical to quad textures
  including tiling, compression, etc.<br>
  </li>
  <li>No padding or data alignment within the file is assumed beyond
what is explicitly specified, though an attempt is made to keep data
aligned within structures.&nbsp; However, data blocks are not generally
aligned on file offsets due to the variable length nature of the zip
compression.<br>
  </li>
</ul>
<h3><br>
</h3>
<h3>General File Structure</h3>
The file is composed of a number of data blocks stored in the order
listed in the table below:
<p>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">Header<br>
      </td>
      <td style="vertical-align: top;">description of file contents
(fixed length, will never grow)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Extended Header<br>
      </td>
      <td style="vertical-align: top;">additional header data, may grow
in future<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Face Info<br>
      </td>
      <td style="vertical-align: top;">information about each face<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Constant Data</td>
      <td style="vertical-align: top;">pre-filtered, constant valued
data for each face</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Level Info<br>
      </td>
      <td style="vertical-align: top;">information about each level<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Level Data<br>
      </td>
      <td style="vertical-align: top;">data for each level<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Meta Data</td>
      <td style="vertical-align: top;">miscellaneous small data stored
as single block<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Compatibility Barrier<br>
      </td>
      <td style="vertical-align: top;">barrier preventing pre-1.3 file readers from reading new data sections<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Large Meta Data<br>
      </td>
      <td style="vertical-align: top;">separately stored large meta
data items<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">(future expansion)<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Edit Data<br>
      </td>
      <td style="vertical-align: top;">incremental edits posted to the
file<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
</p>
<h3>Header</h3>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">magic<br>
      </td>
      <td style="vertical-align: top;">char[4]<br>
      </td>
      <td style="vertical-align: top;">magic identifier = string "Ptex"<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">version<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">major version number (=1)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">meshtype<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">0=triangle, 1=quad<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">datatype<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">0=uint8, 1=uint16, 2=float16,
3=float32<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">alphachan<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">index of alpha channel<br>
&nbsp;-1 (0xffffffff) indicates no
alpha channel<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">nchannels</td>
      <td style="vertical-align: top;">uint16</td>
      <td style="vertical-align: top;">number of data channels</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">nlevels</td>
      <td style="vertical-align: top;">uint16</td>
      <td style="vertical-align: top;">number of levels</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">nfaces<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">number of faces<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">extheader size<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">size of Extended Header block<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">faceinfo size<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">size of Face Info block </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">constdata size</td>
      <td style="vertical-align: top;">uint32</td>
      <td style="vertical-align: top;">size of Constant Data block</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">levelinfo size<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">size of Level Info block </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">minor version</td>
      <td style="vertical-align: top;">uint32</td>
      <td style="vertical-align: top;">minor version number<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">leveldata size</td>
      <td style="vertical-align: top;">uint64</td>
      <td style="vertical-align: top;">total size of all Level Data
blocks<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">metadata zipsize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">on-disk size of Meta Data block
(zipped)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">metadata memsize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">in-memory size of Meta Data
block (unzipped)<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<h3>Extended Header</h3>
<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">ubordermode<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">0=clamp (default), 1=black,
2=periodic<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">vbordermode</td>
      <td style="vertical-align: top;">uint32</td>
      <td style="vertical-align: top;">0=clamp (default), 1=black,
2=periodic</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">largemetadata header zipsize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">on-disk size of Large Meta Data
Header (zipped)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">largemetadata header memsize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">in-memory size of Large Meta
Data Header (unzipped)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">largemetadata size<br>
      </td>
      <td style="vertical-align: top;">uint64<br>
      </td>
      <td style="vertical-align: top;">total on-disk size of Large Meta
Data blocks (not including header)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">editdata size<br>
      </td>
      <td style="vertical-align: top;">uint64<br>
      </td>
      <td style="vertical-align: top;">size of edit data blocks<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">editdata pos<br>
      </td>
      <td style="vertical-align: top;">uint64<br>
      </td>
      <td style="vertical-align: top;">absolute file position of first edit data block<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<h3>Face Info</h3>
Information about the resolution and topological adjacency of each face.<br>
<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">ures<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">log2(number of samples in u
direction)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">vres<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">log2(number of samples in v
direction)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">adjedges</td>
      <td style="vertical-align: top;">uint8</td>
      <td style="vertical-align: top;">ids of edges on adjacent faces
(0 .. 3) x 4 faces (see notes)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">flags<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">bit0=constant - all pixels in
face have same value<br>
bit1=has edits (not stored in file, for api only)<br>
bit2=constant neighborhood - all neighboring faces have same value as
this face<br>
bit3=subface - face is a subface<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">adjfaces<br>
      </td>
      <td style="vertical-align: top;">uint32[4]<br>
      </td>
      <td style="vertical-align: top;">faceids of adjacent faces (0 ..
nfaces)<br>
-1 (0xffffffff) indicates a border (no adjacent face)<br>
      </td>
    </tr>
  </tbody>
</table>
(times number of faces)<br>
<br>
Notes:<br>
<ul>
  <li>The entire block is zip compressed and the
size is indicated in the header.</li>
  <li>Constant faces (indicated by flag bit0) are only stored in the
Constant Data section and not in the Level Data section.<br>
  </li>
  <li>The "adjedge" values are stored as 2-bit values in
little-endian order (i.e the first entry is stored in the lowest 2
bits, etc.). <br>
  </li>
  <li>For triangle meshes, the adjface array has only 3
entries but 4 entries are still
allocated to simplify the implementation (the 4th entry in each case is
0).</li>
  <li>For a face adjacent to a subface, there will always be two
subfaces sharing the edge with the face.&nbsp; The face's adjface id
must point to the first subface as encountered in a counter-clockwise
traversal of the face.<br>
  </li>
</ul>
<br>
<h3>Constant Data</h3>
The constant data block contains a single value per channel for
each
face.&nbsp; For non-constant faces, these values represent the average
of the values for each
face.<br>
<ul>
  <li>The per-channel data values are interleaved for each face, and all the faces are packed together in faceid order.</li>
  <li>The entire block is zip
compressed
as a single unit (with no differencing).</li>
  <li>For textures with alpha, the values are stored
un-multiplied.&nbsp; This is done to exactly preserve the original data
values for constant-valued faces.</li>
  <li>To determine the average value of a non-constant face, the data
are
pre-multiplied with alpha, averaged, and then divided by alpha before
being stored.<br>
  </li>
</ul>
<br>
<h3>Level Info</h3>
The data are grouped into levels with the first level representing the
full-res data for all of the faces, the next level representing a
power-of-two reduction of the first (half the res in both u and v), and
subsequent levels representing half the previous level.&nbsp; The Level
Info
block lists the number of
faces in the level and size of each level's data.&nbsp; <br>
<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">leveldatasize<br>
      </td>
      <td style="vertical-align: top;">uint64<br>
      </td>
      <td style="vertical-align: top;">size of level's data block
(including level data header)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">levelheadersize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">compressed size of level data
header<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">nfaces<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">number of faces in level<br>
      </td>
    </tr>
  </tbody>
</table>
(times number of levels)<br>
<br>
Notes:<br>
<ul>
  <li>The first level stores faces in faceid order.&nbsp; Only
non-constant faces are stored, though all the faces are included in the
level data header.<br>
  </li>
  <li>Reduction levels exclude constant faces and store non-constant
faces in largest-to-smallest order
(according to the smaller dimension of each face).&nbsp; Ordering among
faces with the same smaller-dimension size follows the
original face id
order.&nbsp; The purpose of this ordering is to allow each level to
remain fully populated as the smallest faces may be omitted from the
level.</li>
  <li>The number of faces in reduction levels may be less than the
total number of faces in the file:</li>
  <ul>
    <li>The level data only includes non-constant faces (as indicated
by the
"constant" flag in the face data header).</li>
    <li>As face resolutions are reduced, small faces may be omitted
from further reduction levels.<br>
    </li>
  </ul>
</ul>
<ul>
</ul>
<br>
<h3>Level Data</h3>
Each Level Data block (one per level) consists of a header containing a
list of face sizes
followed by a
number of face data blocks of the given sizes.&nbsp; Non-constant
face data is packed (with channels separated)
and then optionally differenced and compressed.<br>
<br>
Level data header (compressed):<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">facesize<br>
      </td>
      <td style="vertical-align: top;">uint32 (bits 0..29)<br>
      </td>
      <td style="vertical-align: top;">sizes of data block for each face<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">encoding<br>
      </td>
      <td style="vertical-align: top;">bits 30..31 of facesize<br>
      </td>
      <td style="vertical-align: top;">0 = constant valued (1 sample
per channel)<br>
1 = zip compressed<br>
2 = zip compressed w/ differencing<br>
3 = tiled<br>
      </td>
    </tr>
  </tbody>
</table>
(times number of faces in level)<br>
<br>
For tiled faces, the face data begins with the following pre-header:<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">tileures<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">log2(number of samples per tile
in u
direction) <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">tilevres<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">log2(number of samples per tile
in v
direction)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">tileheadersize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">compressed size of tile header<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
and is followed by a compressed header listing the tile sizes and
encodings:<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">tilesizes<br>
      </td>
      <td style="vertical-align: top;">uint32 (bits 0..29)<br>
      </td>
      <td style="vertical-align: top;">sizes of data block for each tile<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">encoding<br>
      </td>
      <td style="vertical-align: top;">bits 30..31 of tilesize<br>
      </td>
      <td style="vertical-align: top;">0 = constant valued (1 sample
per channel)<br>
1 = zip compressed<br>
2 = zip compressed w/ differencing</td>
    </tr>
  </tbody>
</table>
(times number of tiles in face)<br>
<br>
Each tile is then stored separately (with tiles in v-major order) in
the same manner as the untiled face data.&nbsp; Note: the number of
tiles for a face is determined by comparing the tile_ures and tile_vres
with the ures and vres of the face.
<br>
<br>
<br>
<h3>Meta Data<br>
</h3>
Miscellaneous application defined data.&nbsp; Possibilities include
channel names, timestamp, software settings, 3d vertex data, etc.&nbsp;
The
meta data is a stream of individual data blocks.<br>
<br>
Meta data block<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">keysize<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">length of key string (including
null)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">key<br>
      </td>
      <td style="vertical-align: top;">uint8[keysize]<br>
      </td>
      <td style="vertical-align: top;">ascii character string
(null-terminated)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">datatype<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">0=ascii, 1=int8, 2=int16,
3=int32, 4=float, 5=double<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">datasize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">size of data block (in bytes)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">data<br>
      </td>
      <td style="vertical-align: top;">uint8[datasize]<br>
      </td>
      <td style="vertical-align: top;">data block<br>
      </td>
    </tr>
  </tbody>
</table>
<ul>
  <li>The entire stream of data blocks is compressed as a whole.&nbsp;
The compressed and uncompressed sizes are both stored in the header.</li>
  <li>Ascii characters strings (both the key and "ascii" data values)
are stored null-terminated.&nbsp; The size includes the null character.<br>
  </li>
</ul>
<br>

<h3>Compatibility Barrier</h3>

File versions prior to 1.3 lacked the "editdata pos" extended header
attribute.  Early versions of the file reader would seek to the end of
the known data blocks and assume any additional data blocks were edit
blocks.  The compatibility barrier appears to old reader code as an
empty edit block and prevents the old reader from misinterpreting newer
data sections.

The compatibility barrier is always written.
<br>
<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">barrier<br>
      </td>
      <td style="vertical-align: top;">uint64<br>
      </td>
      <td style="vertical-align: top;">must be zero<br>
      </td>
    </tr>
  </tbody>
</table>

<br>
<h3>Large Meta Data</h3>
The large meta data section includes meta data blocks that are stored
separately for individual access (presumably because the items are
large, though there's no real limit).&nbsp; The large meta data section
consists of a header followed by a series of individually compressed
blocks.<br>
<br>
Large meta data header (compressed)<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    
    
    <tr>
      <td style="vertical-align: top;">keysize<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">length of key string (including
null)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">key<br>
      </td>
      <td style="vertical-align: top;">uint8[keysize]<br>
      </td>
      <td style="vertical-align: top;">ascii character string
(null-terminated)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">datatype<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">0=ascii, 1=int8, 2=int16,
3=int32, 4=float, 5=double</td>
    </tr><tr>
      <td style="vertical-align: top;">datasize</td>
      <td style="vertical-align: top;">uint32</td>
      <td style="vertical-align: top;">size of data block (in bytes)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">zipsize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">size of data block on disk<br>
      </td>
    </tr>

  </tbody>
</table>
(times number of large meta data blocks)<br>
<br>
The individual compressed data blocks follow.<br>
<br>
<br>
<h3>Edit Data</h3>
The edit data block includes incremental data edits that are pending to
be applied to the file.&nbsp; The format is designed to allow appending
edit blocks to a file without otherwise affecting the file.<br>
<br>
Edit data block<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">edittype<br>
      </td>
      <td style="vertical-align: top;">uint8<br>
      </td>
      <td style="vertical-align: top;">1=edit face data, 2=edit meta
data<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">editsize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">size of editdata block<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">editdata<br>
      </td>
      <td style="vertical-align: top;">(variable)<br>
      </td>
      <td style="vertical-align: top;">based on edit type<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
Edit face data<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">faceid<br>
      </td>
      <td style="vertical-align: top;">uint32</td>
      <td style="vertical-align: top;">index of face<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">faceinfo<br>
      </td>
      <td style="vertical-align: top;">FaceInfo block<br>
      </td>
      <td style="vertical-align: top;">(as described in FaceInfo
section)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">facesize &amp; encoding<br>
      </td>
      <td style="vertical-align: top;">uint32</td>
      <td style="vertical-align: top;">(as described in Level Data
section)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">constval<br>
      </td>
      <td style="vertical-align: top;">uint8[pixelsize]<br>
      </td>
      <td style="vertical-align: top;">constant value (average pixel
value, as described in Constant Data section)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">facedata<br>
      </td>
      <td style="vertical-align: top;">uint8[facesize]<br>
      </td>
      <td style="vertical-align: top;">encoded data block<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
Edit meta data<br>
<table style="text-align: left;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">metadatazipsize<br>
      </td>
      <td style="vertical-align: top;">uint32<br>
      </td>
      <td style="vertical-align: top;">compressed size of meta data<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">metadatamemsize</td>
      <td style="vertical-align: top;">uint32</td>
      <td style="vertical-align: top;">uncompressed size of meta data</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">metadata<br>
      </td>
      <td style="vertical-align: top;">uint8[metazipsize]<br>
      </td>
      <td style="vertical-align: top;">one or more data blocks (as
described in Meta Data section)<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
</body></html>
